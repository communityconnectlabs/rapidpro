-extends "smartmin/base.html"
-load smartmin i18n static humanize

-block title
  -trans "Check classifier answers for duplicates."

-block subtitle

-block summary
  -trans "Check classifier answers for duplicates."

-block content
  .flex.mb-4.flex-col(style="min-height:41px")
    %form#import-form(method="post" enctype="multipart/form-data")
      -csrf_token

      -if form.non_field_errors
        .text-error.py-2
          {{ form.non_field_errors }}

      -block fields
        .mt-4.mb-6.text-error
          {{ form.file.errors }}
        - if file_uploaded
          %input(type="hidden" name="task" value="{{task.pk}}")
          .uploaded_file
            .file_label
              -trans "Uploaded file"
            .file_name
              =task.origin_file.name
          -render_field 'columns'
        - else
          #download-template.mb-4
            -blocktrans trimmed with sample_url=STATIC_URL|add:"examples/sample_training_data.csv" code=explicit_clear max=max_records|intcomma
              You can download <a href="{{ sample_url }}">this CSV template</a> as a sample
          #file-upload
            %input(type="file" name="file" id="import-file" onchange='onFileChange()' accept="text/csv")
          #real-button.flex.mb-4
            %input(type="text" id="file-field")
            .button-light.ml-4(style="margin-top:-1px")
              -trans "Choose File"

      .flex
        %input.button-primary(type="submit" value='{% trans "Process" %}')
        .ml-4.button-light(onclick="javascript:history.go(-1)")
          -trans "Cancel"

      -if tasks
        %table.list.lined.mt-10
          %thead
            %tr
              %th
                File
              %th
                Status
              %th
                Created By
              %th
                Created On
          %tbody
            -for task in tasks
              %tr
                %td
                  =task.file_name
                %td
                  =task.get_status_display
                %td
                  =task.created_by
                %td
                  =task.created_on
-block extra-script
  {{ block.super }}
  -block spa-script
    %script(src='{% static "bower/bootstrap/js/bootstrap-popover.js" %}')
    :javascript
      function onFileChange() {
        var file = $('#import-file').val();
        while (file.indexOf('\\') >= 0) {
          file = file.substring(file.indexOf('\\') + 1, file.length);
        }
        $('#file-field').val(file);
      }

-block extra-style
  %link(rel='stylesheet' type='text/css' href='{% static "@fortawesome/fontawesome-free/css/all.css" %}')

  :css
    input {
      padding: 9px;
      cursor: pointer;
      box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.04) 0px 3px 20px 0px, rgba(0, 0, 0, 0.02) 0px 1px 2px 0px;
    }

    #file-upload {
      position: relative;
    }

    #file_errors {
      font-size: 20px;
    }

    #real-button {
      position: relative;
      top: 0;
      left: 0;
      z-index: 1;
    }

    #file-field {
      width: 300px;
      height: 35px;
      font-size: 16px;
      margin-bottom: 0px;
      border-radius: 5px;
    }

    #import-file {
      position: absolute;
      width: 450px;
      height: 35px;
      top: 0;
      left: 0;
      text-align: right;
      -moz-opacity:0 ;
      filter: alpha(opacity: 0);
      opacity: 0;
      z-index: 2;
    }

    .uploaded_file > .file_label {
      margin-bottom: 5px;
      margin-left: 4px;
      display: block;
      font-weight: 400;
      font-size: var(--label-size);
      letter-spacing: 0.05em;
      line-height: normal;
      color: rgb(119, 119, 119);
    }

    .uploaded_file > .file_name {
      border-radius: var(--curvature-widget);
      cursor: text;
      background: var(--color-widget-bg);
      border: 1px solid var(--color-widget-border);
      transition: all 0.2s ease-in-out 0s;
      display: flex;
      flex-direction: row;
      align-items: stretch;
      padding: 7px 8px;
      margin-bottom: 10px;
    }
