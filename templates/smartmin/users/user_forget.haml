-extends "smartmin/users/login_base.html"

-load smartmin i18n

-block login-title
  -trans "Reset Password" 

-block login-content
  -blocktrans
    Enter the email address you used to sign up. We will
    send you an email with details on how to reset your password.

  %form.mt-8(method="post" action="{% url 'users.user_forget' %}")
    {% csrf_token %}
    %temba-textinput(type="email" name="email" required="" placeholder='{{_("Email Address")|escapejs}}')
    #recaptcha{style:"margin: 10px 0"}
    %input.mt-4.button-primary(type="submit" value='{{_("Reset Password")}}')

-block extra-script
  %script{src:"https://www.google.com/recaptcha/api.js?render={{ recaptcha_secrete_key }}"}
  %script
    $(document).ready(function() {
      $('form[action="/users/user/forget/"]').attr('onsubmit', 'return validateRecaptcha();');
      var fieldset = document.getElementsByTagName('fieldset');
      var recaptcha = document.createElement('div');
      recaptcha.setAttribute('id', 'recaptcha');
      fieldset[0].appendChild(recaptcha);
    });

    function validateRecaptcha() {
      const response = grecaptcha.getResponse();
      return response.length !== 0;
    }
    grecaptcha.ready(() => {
      grecaptcha.render('recaptcha', {
        'sitekey': '{{ recaptcha_site_key }}'
      });
    });
